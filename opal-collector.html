<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opalåˆ¤æ±ºãƒ‡ãƒ¼ã‚¿åé›†ãƒ„ãƒ¼ãƒ« | ç‰‡ç¿¼ã®ç›Ÿç´„é¨å£«å›£</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .collector-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 20px;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--bg-light);
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            background: var(--bg-light);
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #e2e8f0;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
        }

        .form-select,
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-select:focus,
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-textarea {
            min-height: 150px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.8rem;
            background: var(--bg-light);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-item:hover {
            background: #e2e8f0;
        }

        .checkbox-item input:checked+span {
            color: var(--primary-color);
            font-weight: 600;
        }

        .prompt-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .btn-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #d97706;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .alert-info {
            background: #e0f2fe;
            color: #075985;
            border: 1px solid #7dd3fc;
        }

        .preview-card {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--secondary-color);
        }

        .preview-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .preview-card .meta {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .tag-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag-stat {
            padding: 0.3rem 0.8rem;
            background: var(--bg-light);
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .tag-stat .count {
            font-weight: 700;
            color: var(--primary-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: var(--bg-light);
            font-weight: 700;
            color: var(--primary-dark);
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                text-align: center;
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="images/shield-emblem.png" alt="ç‰‡ç¿¼ã®ç›Ÿç´„é¨å£«å›£" class="logo-emblem">
                <div class="logo-text">
                    <h1>ç‰‡ç¿¼ã®ç›Ÿç´„é¨å£«å›£</h1>
                    <p class="tagline">One-Winged Knights Covenant</p>
                </div>
            </div>
            <nav class="header-nav">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="judgments.html">åˆ¤æ±ºDB</a>
                <a href="opal-collector.html" class="active">ãƒ‡ãƒ¼ã‚¿åé›†</a>
            </nav>
        </div>
    </header>

    <div class="collector-container">
        <h2 style="margin-bottom: 1.5rem; color: var(--primary-dark);">ğŸ”® Opalåˆ¤æ±ºãƒ‡ãƒ¼ã‚¿åé›†ãƒ„ãƒ¼ãƒ«</h2>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="prompt">ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ</button>
            <button class="tab-btn" data-tab="integrate">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿çµ±åˆ</button>
            <button class="tab-btn" data-tab="view">ğŸ“Š ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿</button>
        </div>

        <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¿ãƒ– -->
        <div id="tab-prompt" class="tab-content active">
            <h3 style="margin-bottom: 1rem;">Opalç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ</h3>

            <div class="form-group">
                <label class="form-label">ğŸ“‚ åé›†ã‚«ãƒ†ã‚´ãƒªï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
                <div class="checkbox-group" id="category-checkboxes">
                    <label class="checkbox-item"><input type="checkbox" value="è¦ªæ¨©"> <span>è¦ªæ¨©</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="ç›£è­·è€…æŒ‡å®š"> <span>ç›£è­·è€…æŒ‡å®š</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="é¢ä¼šäº¤æµ"> <span>é¢ä¼šäº¤æµ</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="å­ã®å¼•ãæ¸¡ã—"> <span>å­ã®å¼•ãæ¸¡ã—</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="é¤Šè‚²è²»"> <span>é¤Šè‚²è²»</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="DVãƒ»ãƒ¢ãƒ©ãƒãƒ©"> <span>DVãƒ»ãƒ¢ãƒ©ãƒãƒ©</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="é›¢å©š"> <span>é›¢å©š</span></label>
                    <label class="checkbox-item"><input type="checkbox" value="é€£ã‚Œå»ã‚Š"> <span>é€£ã‚Œå»ã‚Š</span></label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ”‘ è¿½åŠ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰</label>
                <input type="text" class="form-input" id="keywords" placeholder="ä¾‹: çˆ¶è¦ª å‹è¨´, é«˜è£, ç›´æ¥å¼·åˆ¶">
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ“… æœŸé–“</label>
                <select class="form-select" id="period">
                    <option value="2024å¹´ã€œç¾åœ¨">2024å¹´ã€œç¾åœ¨</option>
                    <option value="2023å¹´">2023å¹´</option>
                    <option value="2022å¹´ä»¥å‰">2022å¹´ä»¥å‰</option>
                    <option value="æŒ‡å®šãªã—">æŒ‡å®šãªã—</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ”¢ åé›†ä»¶æ•°</label>
                <select class="form-select" id="count">
                    <option value="5">5ä»¶</option>
                    <option value="10" selected>10ä»¶</option>
                    <option value="20">20ä»¶</option>
                    <option value="30">30ä»¶</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="generatePrompt()">âœ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ</button>

            <div id="prompt-result" style="margin-top: 1.5rem; display: none;">
                <label class="form-label">ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
                <div class="prompt-output" id="prompt-text"></div>
                <div class="btn-row">
                    <button class="btn btn-secondary" onclick="copyPrompt()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                </div>
                <div id="copy-message" class="alert alert-success" style="display: none; margin-top: 1rem;">
                    âœ… ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿çµ±åˆã‚¿ãƒ– -->
        <div id="tab-integrate" class="tab-content">
            <h3 style="margin-bottom: 1rem;">Opalã®å‡ºåŠ›ã‚’çµ±åˆ</h3>

            <div class="alert alert-info">
                ğŸ’¡ Opalã‹ã‚‰å–å¾—ã—ãŸJSONé…åˆ—ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸ã—ã¦æ–°ã—ã„judgments.jsonã‚’ç”Ÿæˆã—ã¾ã™ã€‚
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ“‹ Opalã‹ã‚‰ã®JSONå‡ºåŠ›</label>
                <textarea class="form-textarea" id="opal-output" placeholder='[
  {
    "date": "2024-XX-XX",
    "court": "ã€‡ã€‡å®¶åº­è£åˆ¤æ‰€",
    "title": "åˆ¤æ±ºã‚¿ã‚¤ãƒˆãƒ«",
    "tags": ["è¦ªæ¨©", "é¢ä¼šäº¤æµ"],
    "summary": "äº‹ä¾‹ã®æ¦‚è¦",
    "url": "https://..."
  }
]' style="min-height: 250px;"></textarea>
            </div>

            <div class="btn-row">
                <button class="btn btn-primary" onclick="validateAndPreview()">ğŸ” æ¤œè¨¼ï¼†ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                <button class="btn btn-success" onclick="downloadMerged()" id="download-btn" disabled>ğŸ’¾
                    ãƒãƒ¼ã‚¸æ¸ˆã¿JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>

            <div id="validation-result" style="margin-top: 1.5rem;"></div>
            <div id="preview-area" style="margin-top: 1rem;"></div>
        </div>

        <!-- ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ãƒ– -->
        <div id="tab-view" class="tab-content">
            <h3 style="margin-bottom: 1rem;">ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ</h3>

            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-count">--</div>
                    <div class="stat-label">ç·åˆ¤ä¾‹æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="tag-count">--</div>
                    <div class="stat-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¿ã‚°æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="latest-date">--</div>
                    <div class="stat-label">æœ€æ–°ã®åˆ¤æ±ºæ—¥</div>
                </div>
            </div>

            <h4 style="margin-bottom: 0.5rem;">ã‚¿ã‚°å‡ºç¾å›æ•°ï¼ˆä¸Šä½20ä»¶ï¼‰</h4>
            <div class="tag-stats" id="tag-stats"></div>

            <h4 style="margin: 1.5rem 0 0.5rem;">æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ï¼ˆç›´è¿‘10ä»¶ï¼‰</h4>
            <div id="recent-data"></div>
        </div>
    </div>

    <script>
        let existingData = [];
        let newData = [];

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');

                if (btn.dataset.tab === 'view') {
                    loadExistingData();
                }
            });
        });

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
        function generatePrompt() {
            const categories = Array.from(document.querySelectorAll('#category-checkboxes input:checked'))
                .map(cb => cb.value);
            const keywords = document.getElementById('keywords').value;
            const period = document.getElementById('period').value;
            const count = document.getElementById('count').value;

            if (categories.length === 0) {
                alert('ã‚«ãƒ†ã‚´ãƒªã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const prompt = `ä»¥ä¸‹ã®æ¡ä»¶ã§æ—¥æœ¬ã®å®¶åº­è£åˆ¤æ‰€ã®åˆ¤æ±ºãƒ»äº‹ä¾‹ã‚’${count}ä»¶åé›†ã—ã¦ãã ã•ã„ã€‚

ã€åé›†æ¡ä»¶ã€‘
- ã‚«ãƒ†ã‚´ãƒª: ${categories.join('ã€')}
${keywords ? `- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keywords}` : ''}
- æœŸé–“: ${period}

ã€é‡è¦ãªæŒ‡ç¤ºã€‘
1. å®Ÿåœ¨ã™ã‚‹åˆ¤ä¾‹ãƒ»äº‹ä¾‹ã®ã¿ã‚’åé›†ã—ã¦ãã ã•ã„ï¼ˆæ³•å¾‹äº‹å‹™æ‰€ã®è§£æ±ºäº‹ä¾‹ã‚‚å¯ï¼‰
2. URLã¯å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚‚ã®ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„
3. å¼è­·å£«äº‹å‹™æ‰€ã®è§£æ±ºäº‹ä¾‹ã€è£åˆ¤æ‰€ã®åˆ¤ä¾‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€æ³•å¾‹æƒ…å ±ã‚µã‚¤ãƒˆãªã©ã‹ã‚‰åé›†ã—ã¦ãã ã•ã„

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

\`\`\`json
[
  {
    "date": "YYYY-MM-DD",
    "court": "ã€‡ã€‡å®¶åº­è£åˆ¤æ‰€",
    "title": "äº‹ä¾‹ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30æ–‡å­—ç¨‹åº¦ï¼‰",
    "tags": ["ã‚¿ã‚°1", "ã‚¿ã‚°2", "ã‚¿ã‚°3"],
    "summary": "äº‹ä¾‹ã®æ¦‚è¦ï¼ˆ100æ–‡å­—ç¨‹åº¦ï¼‰",
    "url": "https://å®Ÿéš›ã®URL"
  }
]
\`\`\`

ã€ã‚¿ã‚°ã®ä¾‹ã€‘
è¦ªæ¨©, ç›£è­·è€…æŒ‡å®š, é¢ä¼šäº¤æµ, å­ã®å¼•ãæ¸¡ã—, é¤Šè‚²è²», DV, ãƒ¢ãƒ©ãƒãƒ©, é€£ã‚Œå»ã‚Š, é›¢å©š, çˆ¶è¦ª, æ¯è¦ª, èªå®¹, å´ä¸‹, å’Œè§£, èª¿åœ, å¯©åˆ¤, è¨´è¨Ÿ ãªã©`;

            document.getElementById('prompt-text').textContent = prompt;
            document.getElementById('prompt-result').style.display = 'block';
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
        function copyPrompt() {
            const text = document.getElementById('prompt-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const msg = document.getElementById('copy-message');
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 2000);
            });
        }

        // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        async function validateAndPreview() {
            const input = document.getElementById('opal-output').value.trim();
            const resultDiv = document.getElementById('validation-result');
            const previewDiv = document.getElementById('preview-area');
            const downloadBtn = document.getElementById('download-btn');

            try {
                // JSONãƒ‘ãƒ¼ã‚¹ï¼ˆã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜å·ã‚’é™¤å»ï¼‰
                let cleanInput = input.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                newData = JSON.parse(cleanInput);

                if (!Array.isArray(newData)) {
                    throw new Error('é…åˆ—å½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                }

                // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                await loadExistingData();

                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                const errors = [];
                const warnings = [];
                const existingUrls = new Set(existingData.map(d => d.url));

                newData.forEach((item, i) => {
                    if (!item.date) errors.push(`[${i + 1}] date ãŒæœªè¨­å®š`);
                    if (!item.court) errors.push(`[${i + 1}] court ãŒæœªè¨­å®š`);
                    if (!item.title) errors.push(`[${i + 1}] title ãŒæœªè¨­å®š`);
                    if (!item.tags || !Array.isArray(item.tags)) errors.push(`[${i + 1}] tags ãŒé…åˆ—ã§ãªã„`);
                    if (!item.summary) errors.push(`[${i + 1}] summary ãŒæœªè¨­å®š`);
                    if (!item.url) errors.push(`[${i + 1}] url ãŒæœªè¨­å®š`);
                    if (existingUrls.has(item.url)) warnings.push(`[${i + 1}] "${item.title}" ã¯æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨é‡è¤‡ï¼ˆã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ï¼‰`);
                });

                if (errors.length > 0) {
                    resultDiv.innerHTML = `<div class="alert alert-error">âŒ ã‚¨ãƒ©ãƒ¼:\n${errors.join('\n')}</div>`;
                    downloadBtn.disabled = true;
                    previewDiv.innerHTML = '';
                    return;
                }

                // é‡è¤‡ã‚’é™¤å¤–
                const nonDuplicates = newData.filter(item => !existingUrls.has(item.url));

                let html = `<div class="alert alert-success">âœ… ${newData.length}ä»¶ä¸­ ${nonDuplicates.length}ä»¶ã‚’è¿½åŠ å¯èƒ½</div>`;
                if (warnings.length > 0) {
                    html += `<div class="alert alert-info">âš ï¸ é‡è¤‡:\n${warnings.join('\n')}</div>`;
                }
                resultDiv.innerHTML = html;

                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                previewDiv.innerHTML = '<h4>è¿½åŠ ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿</h4>' +
                    nonDuplicates.map(item => `
                        <div class="preview-card">
                            <h4>${item.title}</h4>
                            <div class="meta">ğŸ“… ${item.date} | ğŸ›ï¸ ${item.court}</div>
                            <div style="margin-top: 0.5rem;">${item.tags.map(t => `<span class="tag-stat">${t}</span>`).join(' ')}</div>
                        </div>
                    `).join('');

                newData = nonDuplicates;
                downloadBtn.disabled = nonDuplicates.length === 0;

            } catch (e) {
                resultDiv.innerHTML = `<div class="alert alert-error">âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${e.message}</div>`;
                previewDiv.innerHTML = '';
                downloadBtn.disabled = true;
            }
        }

        // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadExistingData() {
            try {
                const response = await fetch('data/judgments.json');
                existingData = await response.json();
                updateStats();
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                existingData = [];
            }
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            document.getElementById('total-count').textContent = existingData.length;

            const allTags = {};
            existingData.forEach(item => {
                item.tags.forEach(tag => {
                    allTags[tag] = (allTags[tag] || 0) + 1;
                });
            });

            document.getElementById('tag-count').textContent = Object.keys(allTags).length;

            // æœ€æ–°æ—¥ä»˜
            const dates = existingData.map(d => d.date).sort().reverse();
            document.getElementById('latest-date').textContent = dates[0] || '--';

            // ã‚¿ã‚°çµ±è¨ˆï¼ˆä¸Šä½20ä»¶ï¼‰
            const sortedTags = Object.entries(allTags).sort((a, b) => b[1] - a[1]).slice(0, 20);
            document.getElementById('tag-stats').innerHTML = sortedTags.map(([tag, count]) =>
                `<span class="tag-stat">${tag} <span class="count">(${count})</span></span>`
            ).join('');

            // æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿
            const recent = existingData.slice(-10).reverse();
            document.getElementById('recent-data').innerHTML = recent.map(item => `
                <div class="preview-card">
                    <h4>${item.title}</h4>
                    <div class="meta">ğŸ“… ${item.date} | ğŸ›ï¸ ${item.court}</div>
                </div>
            `).join('');
        }

        // ãƒãƒ¼ã‚¸æ¸ˆã¿JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadMerged() {
            const maxId = Math.max(...existingData.map(d => d.id || 0), 0);
            const mergedData = [
                ...existingData,
                ...newData.map((item, i) => ({
                    id: maxId + i + 1,
                    ...item
                }))
            ];

            const blob = new Blob([JSON.stringify(mergedData, null, 4)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'judgments.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // åˆæœŸèª­ã¿è¾¼ã¿
        loadExistingData();
    </script>
</body>

</html>